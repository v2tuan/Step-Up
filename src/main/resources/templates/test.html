<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>WebSocket Test</title>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
</head>
<body>
<h2>WebSocket Connection Test</h2>
<div id="status">Connecting...</div>

<script>
    // Hàm lấy giá trị cookie theo tên
    function getCookie(name) {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.startsWith(name + '=')) {
                return cookie.substring(name.length + 1);
            }
        }
        return null;
    }

    // Hàm kết nối WebSocket
    function connectWebSocket() {
        const socket = new SockJS('/ws'); // Đường dẫn endpoint trên server
        const stompClient = Stomp.over(socket);

        // Lấy token từ cookie
        const token = getCookie('auth_token');

        const headers = {
            'Authorization': `Bearer ${token}`
        };

        stompClient.connect(headers, function (frame) {
            document.getElementById('status').innerText = '✅ Đã kết nối tới WebSocket!';
            console.log('WebSocket connected:', frame);
        }, function (error) {
            document.getElementById('status').innerText = '❌ Lỗi kết nối WebSocket. Đang thử lại...';
            console.error('WebSocket error:', error);

            // Thử lại sau 5 giây
            setTimeout(connectWebSocket, 5000);
        });
    }

    // Gọi hàm kết nối khi trang được load
    window.onload = function () {
        connectWebSocket();
    };
</script>
</body>
</html>